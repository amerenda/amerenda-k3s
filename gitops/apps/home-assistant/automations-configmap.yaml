apiVersion: v1
kind: ConfigMap
metadata:
  name: homeassistant-automations
  namespace: home-assistant
  annotations:
    reloader.stakater.com/auto: "true"
data:
  alex_camera_privacy_away.yaml: |
    alias: Alex - Camera Privacy (Away)
    mode: restart
    triggers:
      - trigger: zone
        entity_id: person.alex_merenda
        zone: zone.home
        event: leave
    actions:
      - action: light.turn_on
        target:
          entity_id:
            - light.bedroom_status_led
            - light.living_room_status_led
      - action: switch.turn_off
        target:
          entity_id:
            - switch.bedroom_privacy_mode
            - switch.living_room_privacy_mode

  alex_camera_privacy_home.yaml: |
    alias: Alex - Camera Privacy (Home)
    mode: restart
    triggers:
      - trigger: zone
        entity_id: person.alex_merenda
        zone: zone.home
        event: enter
    actions:
      - action: light.turn_off
        target:
          entity_id:
            - light.bedroom_status_led
            - light.living_room_status_led
      - action: switch.turn_on
        target:
          entity_id:
            - switch.bedroom_privacy_mode
            - switch.living_room_privacy_mode

  alex_cleanup_old_photos.yaml: |
    alias: Alex - Cleanup Old Photos (30+ days)
    mode: single
    triggers:
      - platform: time
        at: "02:00:00"
    conditions: []
    actions:
      - service: shell_command.cleanup_old_photos
        data: {}

  alex_reolink_human_detect_alert.yaml: |
    alias: Alex - Reolink Human Alert (Away)
    mode: queued
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.living_room_person
          - binary_sensor.bedroom_person
        from: "off"
        to: "on"
    conditions:
      - condition: not
        conditions:
          - condition: state
            entity_id: person.alex_merenda
            state: "home"
    variables:
      CAM_MAP: >
        {{
          {
            'binary_sensor.living_room_person':
              {'camera': 'camera.living_room_fluent','room':'Living Room','slug':'living_room'},
            'binary_sensor.bedroom_person':
              {'camera': 'camera.bedroom_fluent',    'room':'Bedroom',    'slug':'bedroom'}
          }
        }}
      cam: "{{ CAM_MAP[trigger.entity_id]['camera'] }}"
      room: "{{ CAM_MAP[trigger.entity_id]['room'] }}"
      slug: "{{ CAM_MAP[trigger.entity_id]['slug'] }}"
      timestamp: "{{ now().strftime('%Y%m%d_%H%M%S') }}"
      path: "/config/www/intruders/{{ slug }}_{{ timestamp }}.jpg"
      url: "/local/intruders/{{ slug }}_{{ timestamp }}.jpg"
    actions:
      - action: camera.snapshot
        target: { entity_id: "{{ cam }}" }
        data:
          filename: "{{ path }}"
      - action: notify.mobile_app_pixel_9_pro_xl
        data:
          title: "Human detected - {{ room }}"
          message: "{{ now().strftime('%-I:%M %p on %b %-d') }}"
          data:
            image: "{{ url }}"
            tag: "human-{{ slug }}"
            importance: high
            sticky: true

  alex_reolink_pet_detect_snapshot.yaml: |
    alias: Alex - Reolink Pet Snapshot (Away)
    mode: queued
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.living_room_animal
          - binary_sensor.bedroom_animal
        from: "off"
        to: "on"
    conditions:
      - condition: not
        conditions:
          - condition: state
            entity_id: person.alex_merenda
            state: "home"
    variables:
      CAM_MAP: >
        {{
          {
            'binary_sensor.living_room_animal':
              {'camera': 'camera.living_room_fluent', 'room':'Living Room','slug':'living_room'},
            'binary_sensor.bedroom_animal':
              {'camera': 'camera.bedroom_fluent',     'room':'Bedroom',    'slug':'bedroom'}
          }
        }}
      cam: "{{ CAM_MAP[trigger.entity_id]['camera'] }}"
      room: "{{ CAM_MAP[trigger.entity_id]['room'] }}"
      slug: "{{ CAM_MAP[trigger.entity_id]['slug'] }}"
      timestamp: "{{ now().strftime('%Y%m%d_%H%M%S') }}"
      path: "/config/www/pets/{{ slug }}_{{ timestamp }}.jpg"
      url: "/local/pets/{{ slug }}_{{ timestamp }}.jpg"
    actions:
      - action: camera.snapshot
        target: { entity_id: "{{ cam }}" }
        data:
          filename: "{{ path }}"
      - action: input_text.set_value
        target: { entity_id: input_text.event_image_location_text }
        data: { value: "{{ slug }}" }
      - action: input_text.set_value
        target: { entity_id: input_text.event_image_timestamp_text }
        data: { value: "{{ timestamp }}" }
      - action: notify.mobile_app_pixel_9_pro_xl
        data:
          title: "Pet detected - {{ room }}"
          message: "{{ now().strftime('%-I:%M %p on %b %-d') }}"
          data:
            image: "{{ url }}"
            tag: "pet-{{ slug }}"
            importance: low
            sticky: true

  motion_bathroom.yaml: |
    alias: Motion Activated Lights - Bathroom
    id: motion_bathroom
    description: Turn on bathroom lights with time-appropriate scenes when motion is detected
    use_blueprint:
      path: _defaults/motion_activated_lights.yaml
      input:
        room_name: "bathroom"
        motion_sensor: binary_sensor.bathroom_motion
        target_lights:
          - light.bathroom
        delay_off: 3
        use_schedule: true

  motion_bedroom.yaml: |
    alias: Motion Activated Lights - Bedroom
    id: motion_bedroom
    description: Turn on bedroom lights with time-appropriate scenes when motion is detected
    use_blueprint:
      path: _defaults/motion_activated_lights.yaml
      input:
        room_name: "bedroom"
        motion_sensor: binary_sensor.bedroom_motion
        target_lights:
          - light.bedroom
        delay_off: 15
        use_schedule: true

  motion_hallway.yaml: |
    alias: Motion Activated Lights - Hallway
    id: motion_hallway
    description: Turn on hallway lights with time-appropriate scenes when motion is detected
    use_blueprint:
      path: _defaults/motion_activated_lights.yaml
      input:
        room_name: "hallway"
        motion_sensor: binary_sensor.hallway_motion
        target_lights:
          - light.hallway
        delay_off: 2
        use_schedule: true

  motion_kitchen.yaml: |
    alias: Motion Activated Lights - Kitchen
    id: motion_kitchen
    description: Turn on kitchen lights with time-appropriate scenes when motion is detected
    use_blueprint:
      path: _defaults/motion_activated_lights.yaml
      input:
        room_name: "kitchen"
        motion_sensor: binary_sensor.kitchen_motion
        target_lights:
          - light.kitchen
        delay_off: 5
        use_schedule: true

  motion_living_room.yaml: |
    alias: Motion Activated Lights - Living Room
    id: motion_living_room
    description: Turn on living room lights with time-appropriate scenes when motion is detected
    use_blueprint:
      path: _defaults/motion_activated_lights.yaml
      input:
        room_name: "living_room"
        motion_sensor: binary_sensor.living_room_motion
        target_lights:
          - light.living_room
        delay_off: 10
        use_schedule: true

  switch_control_bathroom.yaml: |
    alias: Switch Control - Bathroom
    id: bathroom_switch_control
    description: Control bathroom lights with Hue switch buttons
    use_blueprint:
      path: _defaults/hue_switch_control.yaml
      input:
        target_lights:
          - light.bathroom
        switch_entity: event.bathroom_switch_button_1
        button_1_toggle: true
        button_2_brightness_up: true
        button_3_brightness_down: true
        button_4_custom: true
        button_4_action: scene_cycle
        scene_entities:
          - scene.bathroom_nightlight
          - scene.bathroom_relax
          - scene.bathroom_energize
        button_1_long_press: true
        button_1_long_action: all_lights_off
        button_4_long_press: true
        button_4_long_action: room_relax_scene
        room_relax_scene: scene.bathroom_relax
        brightness_step: 25
        min_brightness: 1
        max_brightness: 255
        # Room configuration for dynamic scene construction
        room_name: "bathroom"
        use_dashboard_schedule: true

  switch_control_bedroom.yaml: |
    alias: Switch Control - Bedroom
    id: bedroom_switch_control
    description: Control bedroom lights with Hue switch buttons
    use_blueprint:
      path: _defaults/hue_switch_control.yaml
      input:
        target_lights:
          - light.bedroom
        switch_entity: event.bedroom_switch_button_1
        button_1_toggle: true
        button_2_brightness_up: true
        button_3_brightness_down: true
        button_4_custom: true
        button_4_action: scene_cycle
          - scene.bedroom_nightlight
          - scene.bedroom_relax
          - scene.bedroom_energize
          - scene.bedroom_concentrate
          - scene.bedroom_read
        button_1_long_press: true
        button_1_long_action: all_lights_off
        button_4_long_press: true
        button_4_long_action: room_relax_scene
        room_relax_scene: scene.scene.bedroom_sunset_allure
        brightness_step: 25
        min_brightness: 1
        max_brightness: 255
        # Room configuration for dynamic scene construction
        room_name: "bedroom"
        use_dashboard_schedule: true

  switch_control_hallway.yaml: |
    alias: Switch Control - Hallway
    id: hallway_switch_control
    description: Control hallway lights with Hue switch buttons
    use_blueprint:
      path: _defaults/hue_switch_control.yaml
      input:
        target_lights:
          - light.hallway
        switch_entity: event.hallway_switch_button_1
        button_1_toggle: true
        button_2_brightness_up: true
        button_3_brightness_down: true
        button_4_custom: true
        button_4_action: scene_cycle
        scene_entities:
          - scene.hallway_nightlight
          - scene.hallway_relax
          - scene.hallway_energize
        button_1_long_press: true
        button_1_long_action: all_lights_off
        button_4_long_press: true
        button_4_long_action: room_relax_scene
        room_relax_scene: scene.hallway_relax
        brightness_step: 25
        min_brightness: 1
        max_brightness: 255
        # Room configuration for dynamic scene construction
        room_name: "hallway"
        use_dashboard_schedule: true

  switch_control_hallway_2.yaml: |
    alias: Switch Control - Hallway 2
    id: hallway_2_switch_control
    description: Control hallway lights with second Hue switch buttons
    use_blueprint:
      path: _defaults/hue_switch_control.yaml
      input:
        target_lights:
          - light.hallway
        switch_entity: event.hallway_switch_button_2
        button_1_toggle: true
        button_2_brightness_up: true
        button_3_brightness_down: true
        button_4_custom: true
        button_4_action: scene_cycle
        scene_entities:
          - scene.hallway_nightlight
          - scene.hallway_relax
          - scene.hallway_energize
        button_1_long_press: true
        button_1_long_action: all_lights_off
        button_4_long_press: true
        button_4_long_action: room_relax_scene
        room_relax_scene: scene.hallway_relax
        brightness_step: 25
        min_brightness: 1
        max_brightness: 255
        # Room configuration for dynamic scene construction
        room_name: "hallway"
        use_dashboard_schedule: true

  switch_control_kitchen.yaml: |
    alias: Switch Control - Kitchen
    id: kitchen_switch_control
    description: Control kitchen lights with Hue switch buttons
    use_blueprint:
      path: _defaults/hue_switch_control.yaml
      input:
        target_lights:
          - light.kitchen
        switch_entity: event.kitchen_switch_button_1
        button_1_toggle: true
        button_2_brightness_up: true
        button_3_brightness_down: true
        button_4_custom: true
        button_4_action: scene_cycle
        scene_entities:
          - scene.kitchen_nightlight
          - scene.kitchen_relax
          - scene.kitchen_energize
        button_1_long_press: true
        button_1_long_action: all_lights_off
        button_4_long_press: true
        button_4_long_action: room_relax_scene
        room_relax_scene: scene.kitchen_relax
        brightness_step: 25
        min_brightness: 1
        max_brightness: 255
        # Room configuration for dynamic scene construction
        room_name: "kitchen"
        use_dashboard_schedule: true

  switch_control_living_room.yaml: |
    alias: Switch Control - Living Room
    id: living_room_switch_control
    description: Control living room lights with Hue switch buttons
    use_blueprint:
      path: _defaults/hue_switch_control.yaml
      input:
        target_lights:
          - light.living_room
        switch_entity: event.living_room_switch_button_1
        button_1_toggle: true
        button_2_brightness_up: true
        button_3_brightness_down: true
        button_4_custom: true
        button_4_action: scene_cycle
        scene_entities:
          - scene.living_room_nightlight
          - scene.living_room_relax
          - scene.living_room_energize
          - scene.living_room_concentrate
          - scene.living_room_read
        button_1_long_press: true
        button_1_long_action: all_lights_off
        button_4_long_press: true
        button_4_long_action: room_relax_scene
        room_relax_scene: scene.home_movie
        brightness_step: 25
        min_brightness: 1
        max_brightness: 255
        # Room configuration for dynamic scene construction
        room_name: "living_room"
        use_dashboard_schedule: true

