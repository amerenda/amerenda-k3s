views:
  - title: Overview
    icon: mdi:train
    cards:
      - type: vertical-stack
        cards:
          # --- ATLANTIC AV ---
          - type: custom:auto-entities
            card:
              type: entities
              title: Atlantic Av-Barclays Ctr
              show_header_toggle: false
            filter:
              template: |
                {% for state in states.sensor -%}
                  {%- if state.attributes.friendly_name is defined and 'Atlantic Av' in state.attributes.friendly_name and state.state not in ['unavailable', 'unknown'] -%}
                    {%- set route = state.attributes.route_id | default('?') -%}
                    {%- set headsign = state.attributes.headsign | default('Unknown') -%}
                    {{
                      {
                        'entity': state.entity_id,
                        'name': route ~ " -> " ~ headsign,
                        'secondary_info': 'last-updated'
                      } 
                    }},
                  {%- endif -%}
                {%- endfor %}
            sort:
              method: attribute
              attribute: route_id

          # --- BERGEN ST ---
          - type: custom:auto-entities
            card:
              type: entities
              title: Bergen St
              show_header_toggle: false
            filter:
              template: |
                {% for state in states.sensor -%}
                  {%- if state.attributes.friendly_name is defined and 'Bergen St' in state.attributes.friendly_name and state.state not in ['unavailable', 'unknown'] -%}
                    {%- set route = state.attributes.route_id | default('?') -%}
                    {%- set headsign = state.attributes.headsign | default('Unknown') -%}
                    {{
                      {
                        'entity': state.entity_id,
                        'name': route ~ " -> " ~ headsign,
                        'secondary_info': 'last-updated'
                      } 
                    }},
                  {%- endif -%}
                {%- endfor %}
            sort:
              method: attribute
              attribute: route_id

          # --- FULTON ST ---
          - type: custom:auto-entities
            card:
              type: entities
              title: Fulton St
              show_header_toggle: false
            filter:
              template: |
                {% for state in states.sensor -%}
                  {%- if state.attributes.friendly_name is defined and 'Fulton St' in state.attributes.friendly_name and state.state not in ['unavailable', 'unknown'] -%}
                    {%- set route = state.attributes.route_id | default('?') -%}
                    {%- set headsign = state.attributes.headsign | default('Unknown') -%}
                    {{
                      {
                        'entity': state.entity_id,
                        'name': route ~ " -> " ~ headsign,
                        'secondary_info': 'last-updated'
                      } 
                    }},
                  {%- endif -%}
                {%- endfor %}
            sort:
              method: attribute
              attribute: route_id

          # --- LAFAYETTE AV ---
          - type: custom:auto-entities
            card:
              type: entities
              title: Lafayette Av
              show_header_toggle: false
            filter:
              template: |
                {% for state in states.sensor -%}
                  {%- if state.attributes.friendly_name is defined and 'Lafayette Av' in state.attributes.friendly_name and state.state not in ['unavailable', 'unknown'] -%}
                    {%- set route = state.attributes.route_id | default('?') -%}
                    {%- set headsign = state.attributes.headsign | default('Unknown') -%}
                    {{
                      {
                        'entity': state.entity_id,
                        'name': route ~ " -> " ~ headsign,
                        'secondary_info': 'last-updated'
                      } 
                    }},
                  {%- endif -%}
                {%- endfor %}
            sort:
              method: attribute
              attribute: route_id

          # --- 57 ST ---
          - type: custom:auto-entities
            card:
              type: entities
              title: 57 St-7 Av
              show_header_toggle: false
            filter:
              template: |
                {% for state in states.sensor -%}
                  {%- if state.attributes.friendly_name is defined and '57 St' in state.attributes.friendly_name and state.state not in ['unavailable', 'unknown'] -%}
                    {%- set route = state.attributes.route_id | default('?') -%}
                    {%- set headsign = state.attributes.headsign | default('Unknown') -%}
                    {{
                      {
                        'entity': state.entity_id,
                        'name': route ~ " -> " ~ headsign,
                        'secondary_info': 'last-updated'
                      } 
                    }},
                  {%- endif -%}
                {%- endfor %}
            sort:
              method: attribute
              attribute: route_id

  - title: Morning Commute
    icon: mdi:weather-sunset-up
    cards:
      - type: custom:auto-entities
        card:
          type: entities
          title: Morning Commute (All Atlantic Av Trains)
          show_header_toggle: false
        filter:
          include:
            - domain: sensor
              attributes:
                friendly_name: "/Atlantic Av|Barclays/"
                route_id: ["N", "Q", "D"]
              options:
                 secondary_info: last-updated
          exclude:
            - state: "unavailable"
            - state: "unknown"
        sort:
          method: state
          numeric: true

  - title: Evening Commute
    icon: mdi:weather-night
    cards:
      - type: custom:auto-entities
        card:
          type: entities
          title: Evening Commute (All 57 St Trains)
          show_header_toggle: false
        filter:
          include:
            - domain: sensor
              attributes:
                friendly_name: "/57 St/"
                route_id: ["N", "Q", "R", "W"]
              options:
                 secondary_info: last-updated
          exclude:
            - state: "unavailable"
            - state: "unknown"
        sort:
          method: state
          numeric: true

  - title: Dynamic
    icon: mdi:map-marker-radius
    cards:
      - type: conditional
        conditions:
          - entity: device_tracker.pixel_9_pro_xl
            state_not: "work"
        card:
          type: custom:auto-entities
          card:
            type: entities
            title: To Work (All Atlantic Av Trains)
            icon: mdi:briefcase
            show_header_toggle: false
          filter:
            include:
              - domain: sensor
                attributes:
                  friendly_name: "/Atlantic Av|Barclays/"
                  route_id: ["N", "Q", "D"]
                options:
                   secondary_info: last-updated
            exclude:
              - state: "unavailable"
              - state: "unknown"
          sort:
            method: state
            numeric: true

      - type: conditional
        conditions:
          - entity: device_tracker.pixel_9_pro_xl
            state: "work"
        card:
          type: custom:auto-entities
          card:
            type: entities
            title: To Home (All 57 St Trains)
            icon: mdi:home
            show_header_toggle: false
          filter:
            include:
              - domain: sensor
                attributes:
                  friendly_name: "/57 St/"
                  route_id: ["N", "Q", "R", "W"]
                options:
                   secondary_info: last-updated
            exclude:
              - state: "unavailable"
              - state: "unknown"
          sort:
            method: state
            numeric: true
