type: vertical-stack
cards:
  # Room selector dropdown
  - type: entities
    title: Select Room
    entities:
      - entity: input_select.room_selector
        name: Room

  # Active Scene Status Card
  - type: markdown
    title: Current Status
    content: |
      {% set room = states('input_select.room_selector') %}
      {% if room and room != 'unknown' and room != 'unavailable' %}
        {% set custom_schedule = states('input_boolean.' ~ room ~ '_custom_schedule') %}
        {% set s1 = states('input_datetime.' ~ room ~ '_s1_start') if custom_schedule == 'on' else '06:00:00' %}
        {% set s2 = states('input_datetime.' ~ room ~ '_s2_start') if custom_schedule == 'on' else '09:00:00' %}
        {% set s3 = states('input_datetime.' ~ room ~ '_s3_start') if custom_schedule == 'on' else '17:00:00' %}
        {% set s4 = states('input_datetime.' ~ room ~ '_s4_start') if custom_schedule == 'on' else '22:00:00' %}
        {% set now_ts = as_timestamp(now()) %}
        {% set s1_ts = as_timestamp(today_at(s1)) %}
        {% set s2_ts = as_timestamp(today_at(s2)) %}
        {% set s3_ts = as_timestamp(today_at(s3)) %}
        {% set s4_ts = as_timestamp(today_at(s4)) %}
        {% if now_ts >= s1_ts and now_ts < s2_ts %}
          {% set current_slot = 'morning' %}
          {% set next_transition = s2[:5] %}
          {% set next_slot = 'day' %}
        {% elif now_ts >= s2_ts and now_ts < s3_ts %}
          {% set current_slot = 'day' %}
          {% set next_transition = s3[:5] %}
          {% set next_slot = 'evening' %}
        {% elif now_ts >= s3_ts and now_ts < s4_ts %}
          {% set current_slot = 'evening' %}
          {% set next_transition = s4[:5] %}
          {% set next_slot = 'night' %}
        {% else %}
          {% set current_slot = 'night' %}
          {% set next_transition = s1[:5] %}
          {% set next_slot = 'morning' %}
        {% endif %}
        {% set scene_cycle = states('input_select.' ~ room ~ '_scene_cycle') %}
        
        ### **{{ current_slot|title }} Scene Active**
        
        {% if scene_cycle and scene_cycle != 'unknown' and scene_cycle != 'unavailable' %}
          Manual override: {{ scene_cycle|title }}
        {% endif %}
        
        Next transition: **{{ next_transition }}** → {{ next_slot|title }}
      {% else %}
        Please select a room above.
      {% endif %}

  # Manual Scene Control Buttons - Conditional cards per room
  - type: conditional
    conditions:
      - entity: input_select.room_selector
        state: bathroom
    card:
      type: horizontal-stack
      cards:
        - type: button
          entity: scene.bathroom_morning
          name: Morning
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.bathroom_morning
          show_state: false
        - type: button
          entity: scene.bathroom_day
          name: Day
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.bathroom_day
          show_state: false
        - type: button
          entity: scene.bathroom_evening
          name: Evening
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.bathroom_evening
          show_state: false
        - type: button
          entity: scene.bathroom_night
          name: Night
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.bathroom_night
          show_state: false

  - type: conditional
    conditions:
      - entity: input_select.room_selector
        state: bedroom
    card:
      type: horizontal-stack
      cards:
        - type: button
          entity: scene.bedroom_morning
          name: Morning
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.bedroom_morning
          show_state: false
        - type: button
          entity: scene.bedroom_day
          name: Day
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.bedroom_day
          show_state: false
        - type: button
          entity: scene.bedroom_evening
          name: Evening
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.bedroom_evening
          show_state: false
        - type: button
          entity: scene.bedroom_night
          name: Night
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.bedroom_night
          show_state: false

  - type: conditional
    conditions:
      - entity: input_select.room_selector
        state: hallway
    card:
      type: horizontal-stack
      cards:
        - type: button
          entity: scene.hallway_morning
          name: Morning
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.hallway_morning
          show_state: false
        - type: button
          entity: scene.hallway_day
          name: Day
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.hallway_day
          show_state: false
        - type: button
          entity: scene.hallway_evening
          name: Evening
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.hallway_evening
          show_state: false
        - type: button
          entity: scene.hallway_night
          name: Night
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.hallway_night
          show_state: false

  - type: conditional
    conditions:
      - entity: input_select.room_selector
        state: kitchen
    card:
      type: horizontal-stack
      cards:
        - type: button
          entity: scene.kitchen_morning
          name: Morning
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.kitchen_morning
          show_state: false
        - type: button
          entity: scene.kitchen_day
          name: Day
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.kitchen_day
          show_state: false
        - type: button
          entity: scene.kitchen_evening
          name: Evening
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.kitchen_evening
          show_state: false
        - type: button
          entity: scene.kitchen_night
          name: Night
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.kitchen_night
          show_state: false

  - type: conditional
    conditions:
      - entity: input_select.room_selector
        state: living_room
    card:
      type: horizontal-stack
      cards:
        - type: button
          entity: scene.living_room_morning
          name: Morning
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.living_room_morning
          show_state: false
        - type: button
          entity: scene.living_room_day
          name: Day
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.living_room_day
          show_state: false
        - type: button
          entity: scene.living_room_evening
          name: Evening
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.living_room_evening
          show_state: false
        - type: button
          entity: scene.living_room_night
          name: Night
          tap_action:
            action: call-service
            service: scene.turn_on
            service_data:
              entity_id: scene.living_room_night
          show_state: false

  # Schedule Display
  - type: markdown
    title: Schedule
    content: |
      {% set room = states('input_select.room_selector') %}
      {% if room and room != 'unknown' and room != 'unavailable' %}
        {% set custom_schedule = states('input_boolean.' ~ room ~ '_custom_schedule') %}
        {% set s1 = states('input_datetime.' ~ room ~ '_s1_start') if custom_schedule == 'on' else '06:00:00' %}
        {% set s2 = states('input_datetime.' ~ room ~ '_s2_start') if custom_schedule == 'on' else '09:00:00' %}
        {% set s3 = states('input_datetime.' ~ room ~ '_s3_start') if custom_schedule == 'on' else '17:00:00' %}
        {% set s4 = states('input_datetime.' ~ room ~ '_s4_start') if custom_schedule == 'on' else '22:00:00' %}
        
        **Morning**: {{ s1[:5] }} → Day
        
        **Day**: {{ s2[:5] }} → Evening
        
        **Evening**: {{ s3[:5] }} → Night
        
        **Night**: {{ s4[:5] }} → Morning
        
        {% if custom_schedule == 'on' %}
          *Custom schedule enabled*
        {% else %}
          *Default schedule (06:00, 09:00, 17:00, 22:00)*
        {% endif %}
      {% else %}
        Please select a room above.
      {% endif %}

